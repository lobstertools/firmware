; PlatformIO Project Configuration File
[platformio]
default_envs = esp32_diymore_debug

; =======================================================
; 1. Shared Configuration (Global)
;    Only put settings here that apply to BOTH Native AND ESP32.
; =======================================================
[env]
monitor_speed = 115200

; =======================================================
; 2. Shared ESP32 Base Configuration
;    This section is NOT a build target. It holds settings
;    shared by Debug and Release environments.
; =======================================================
[esp32_base]
platform = espressif32
board = esp32dev
framework = arduino
upload_speed = 230400
board_build.partitions = no_ota.csv
extra_scripts = scripts/run_clangformat.py
lib_deps =
    esp32async/ESPAsyncWebServer@^3.8.1
    bblanchon/ArduinoJson@^7.0.4
    mathertel/OneButton@^2.6.1
    jandelgado/JLed@^4.15.0

; =======================================================
; 3. Native Test Environment (Your Computer)
;    Clean environment without ESP32 libraries.
; =======================================================
[env:native]
platform = native
test_framework = unity
build_flags = 
    -I lib/SessionEngine 
    -I test
    --coverage
extra_scripts = 
    scripts/add_coverage.py
lib_deps = 
    bblanchon/ArduinoJson@^7.0.4

; =======================================================
; 4. ESP32 Build Environments
; =======================================================

[env:esp32_diymore_debug]
extends = esp32_base
build_flags =
    -D DEBUG_MODE
    -D DEVICE_VERSION='"v0.0.0-local-debug"'

[env:esp32_diymore_release]
extends = esp32_base
build_flags =
    -D DEVICE_VERSION='"v0.0.0-local-release"'
    -D CORE_DEBUG_LEVEL=0